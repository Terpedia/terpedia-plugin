<!DOCTYPE html><html><head><title>Patient Cases - Case Management System</title><meta name='viewport' content='width=device-width, initial-scale=1'>
        <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }
        
        .terpedia-case-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .case-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .case-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .case-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .case-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #007cba;
            color: white;
        }
        
        .btn-primary:hover {
            background: #005a87;
        }
        
        .btn-outline {
            background: transparent;
            color: #007cba;
            border: 2px solid #007cba;
        }
        
        .btn-outline:hover {
            background: #007cba;
            color: white;
        }
        
        .btn-ai {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-ai:hover {
            background: #7c3aed;
        }
        
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .case-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .case-card:hover {
            transform: translateY(-2px);
        }
        
        .case-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .case-card h3 {
            margin: 0;
            font-size: 1.3rem;
        }
        
        .case-card h3 a {
            text-decoration: none;
            color: #333;
        }
        
        .case-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-completed {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .case-card-body p {
            margin: 8px 0;
            color: #666;
        }
        
        .case-card-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        .case-nav {
            background: white;
            border-radius: 8px;
            padding: 0;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        
        .nav-back {
            padding: 15px 20px;
            text-decoration: none;
            color: #666;
            border-right: 1px solid #eee;
        }
        
        .case-nav-tabs {
            display: flex;
            flex: 1;
        }
        
        .nav-tab {
            padding: 15px 20px;
            text-decoration: none;
            color: #666;
            border-right: 1px solid #eee;
            transition: background 0.2s;
        }
        
        .nav-tab:hover,
        .nav-tab.active {
            background: #f8f9fa;
            color: #007cba;
        }
        
        .case-detail-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .case-info h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
        }
        
        .case-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .form-section h3 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #007cba;
            padding-bottom: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007cba;
        }
        
        .form-actions {
            text-align: right;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .chat-container {
            background: white;
            border-radius: 12px;
            height: 70vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header h2 {
            margin: 0;
            color: #333;
        }
        
        .ai-status {
            color: #8b5cf6;
            font-weight: 600;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .message.user {
            background: #007cba;
            color: white;
            margin-left: auto;
        }
        
        .message.ai {
            background: #8b5cf6;
            color: white;
        }
        
        .message.system {
            background: #e5e7eb;
            color: #374151;
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .chat-input-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        #chat-input {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 12px;
            resize: none;
            font-family: inherit;
        }
        
        .chat-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .no-cases {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .case-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .case-detail-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .case-nav {
                flex-direction: column;
            }
            
            .nav-back {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
            
            .case-nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
        </style></head><body><div class='terpedia-case-container'><header class='case-header'><h1>üè• Patient Case Management System</h1><p>Comprehensive health record management with AI assistance</p><div class='case-actions'><button onclick='createNewCase()' class='btn btn-primary'>+ New Case</button></div></header><div class='cases-grid'><div class='case-card' data-case-id='1069'><div class='case-card-header'><h3><a href='/case/1069'>Bella</a></h3><span class='case-status status-active'>active</span></div><div class='case-card-body'><p><strong>Species:</strong> Canine</p><p><strong>Case ID:</strong> #1069</p><p><strong>Last Updated:</strong> 2025-09-17 15:09</p></div><div class='case-card-actions'><a href='/case/1069' class='btn btn-outline'>View Case</a><a href='/case/1069/chat' class='btn btn-outline'>Chat</a></div></div><div class='case-card' data-case-id='8664'><div class='case-card-header'><h3><a href='/case/8664'>Thunder</a></h3><span class='case-status status-active'>active</span></div><div class='case-card-body'><p><strong>Species:</strong> Equine</p><p><strong>Case ID:</strong> #8664</p><p><strong>Last Updated:</strong> 2025-09-17 15:09</p></div><div class='case-card-actions'><a href='/case/8664' class='btn btn-outline'>View Case</a><a href='/case/8664/chat' class='btn btn-outline'>Chat</a></div></div><div class='case-card' data-case-id='6841'><div class='case-card-header'><h3><a href='/case/6841'>Whiskers</a></h3><span class='case-status status-critical'>critical</span></div><div class='case-card-body'><p><strong>Species:</strong> Feline</p><p><strong>Case ID:</strong> #6841</p><p><strong>Last Updated:</strong> 2025-09-17 15:09</p></div><div class='case-card-actions'><a href='/case/6841' class='btn btn-outline'>View Case</a><a href='/case/6841/chat' class='btn btn-outline'>Chat</a></div></div><div class='case-card' data-case-id='7377'><div class='case-card-header'><h3><a href='/case/7377'>Rocky (Emergency #E2024-089)</a></h3><span class='case-status status-critical'>critical</span></div><div class='case-card-body'><p><strong>Species:</strong> Canine</p><p><strong>Case ID:</strong> #7377</p><p><strong>Last Updated:</strong> 2025-09-17 15:09</p></div><div class='case-card-actions'><a href='/case/7377' class='btn btn-outline'>View Case</a><a href='/case/7377/chat' class='btn btn-outline'>Chat</a></div></div></div></div>
        <script>
        // Case management JavaScript
        function createNewCase() {
            const name = prompt('Enter patient name:');
            if (name) {
                window.location.href = '/wp-admin/post-new.php?post_type=terpedia_case&patient_name=' + encodeURIComponent(name);
            }
        }
        
        function editCase(caseId) {
            document.querySelector('#case-form').classList.add('editing');
            document.querySelector('#case-form input[name="patient_name"]').focus();
        }
        
        function exportCase(caseId) {
            window.open('/wp-admin/admin-ajax.php?action=export_case&case_id=' + caseId, '_blank');
        }
        
        function resetForm() {
            document.getElementById('case-form').reset();
        }
        
        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            const caseId = document.querySelector('#chat-messages').dataset.caseId;
            
            // Add message to chat immediately
            addMessageToChat('user', message);
            input.value = '';
            
            // Send via AJAX
            fetch('/wp-admin/admin-ajax.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'terpedia_send_case_message',
                    case_id: caseId,
                    message: message,
                    user_type: 'human'
                })
            });
        }
        
        function askAI() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim() || 'Please provide insights about this case.';
            const caseId = document.querySelector('#chat-messages').dataset.caseId;
            
            addMessageToChat('user', message);
            addMessageToChat('ai', 'Thinking...', true);
            input.value = '';
            
            fetch('/wp-admin/admin-ajax.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'terpedia_send_case_message',
                    case_id: caseId,
                    message: message,
                    user_type: 'ai_request'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.data.ai_response) {
                    updateLastMessage(data.data.ai_response);
                }
            });
        }
        
        function addMessageToChat(type, message, isTemporary = false) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type + (isTemporary ? ' temporary' : '');
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            messageDiv.innerHTML = 
                '<div class="message-content">' + message + '</div>' +
                '<div class="message-time">' + timeStr + '</div>';
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function updateLastMessage(newContent) {
            const messages = document.querySelectorAll('#chat-messages .message.temporary');
            if (messages.length > 0) {
                const lastMessage = messages[messages.length - 1];
                lastMessage.querySelector('.message-content').innerHTML = newContent;
                lastMessage.classList.remove('temporary');
            }
        }
        
        // Load chat messages on page load
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages) {
                loadChatMessages();
            }
            
            // Set up form submission
            const caseForm = document.getElementById('case-form');
            if (caseForm) {
                caseForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveCaseData();
                });
            }
            
            // Enter key in chat
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        });
        
        function loadChatMessages() {
            const caseId = document.querySelector('#chat-messages').dataset.caseId;
            
            fetch('/wp-admin/admin-ajax.php?action=terpedia_get_case_messages&case_id=' + caseId)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const messagesContainer = document.getElementById('chat-messages');
                        messagesContainer.innerHTML = '';
                        
                        data.data.forEach(message => {
                            addMessageToChat(message.user_type, message.message);
                        });
                    }
                });
        }
        
        function saveCaseData() {
            const form = document.getElementById('case-form');
            const formData = new FormData(form);
            const caseId = form.dataset.caseId;
            
            formData.append('action', 'terpedia_save_case_data');
            formData.append('case_id', caseId);
            
            fetch('/wp-admin/admin-ajax.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Case saved successfully!', 'success');
                } else {
                    showNotification('Error saving case: ' + data.data, 'error');
                }
            });
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.textContent = message;
            notification.style.cssText = 
                'position: fixed;' +
                'top: 20px;' +
                'right: 20px;' +
                'padding: 15px 20px;' +
                'border-radius: 6px;' +
                'color: white;' +
                'font-weight: 600;' +
                'z-index: 1000;' +
                'background: ' + (type === 'success' ? '#10b981' : '#ef4444') + ';';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        </script></body></html>